---
import BaseLayout from './BaseLayout.astro';
import PostNavigation from '../components/PostNavigation.astro';
import { useTranslations, type Language } from '../utils/i18n';
import type { CollectionEntry } from 'astro:content';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  tags: string[];
  lang: Language;
  availableLanguages: Language[];
  baseSlug: string;
  prevPost?: CollectionEntry<'posts'> | null;
  nextPost?: CollectionEntry<'posts'> | null;
}

const { title, description, pubDate, updatedDate, tags, lang, availableLanguages, baseSlug, prevPost, nextPost } = Astro.props;
const t = useTranslations(lang);
---

<BaseLayout
  title={title}
  description={description}
  lang={lang}
  availableLanguages={availableLanguages}
  postSlug={baseSlug}
>
  <article class="max-w-3xl mx-auto">
    <header class="mb-12">
      <h1 class="post-title">{title}</h1>
      <p class="post-description">{description}</p>
      <div class="post-meta">
        <time datetime={pubDate.toISOString()}>
          {t('post.published')} {pubDate.toLocaleDateString(lang)}
        </time>
        {updatedDate && (
          <time datetime={updatedDate.toISOString()}>
            | {t('post.updated')} {updatedDate.toLocaleDateString(lang)}
          </time>
        )}
      </div>
    </header>

    <div class="tags-container">
      <span class="tags-label">{t('post.tags')}:</span>
      {tags.map((tag) => (
        <a href={`/tags/${tag.toLowerCase().replace(/\s+/g, '-')}`} class="tag-pill">
          {tag}
        </a>
      ))}
    </div>

    <div class="prose prose-lg max-w-none">
      <slot />
    </div>

    <PostNavigation
      prevPost={prevPost ?? null}
      nextPost={nextPost ?? null}
      prevLabel={t('post.previous')}
      nextLabel={t('post.next')}
    />
  </article>
</BaseLayout>

<style>
  .post-title {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-text-primary);
    line-height: var(--line-height-tight);
    margin-bottom: var(--spacing-4);
  }

  .post-description {
    font-size: var(--font-size-xl);
    color: var(--color-text-secondary);
    line-height: var(--line-height-normal);
    margin-bottom: var(--spacing-4);
  }

  .post-meta {
    font-size: var(--font-size-sm);
    color: var(--color-text-light);
  }

  .tags-container {
    display: flex;
    gap: var(--spacing-2);
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: var(--spacing-8);
    font-size: var(--font-size-sm);
  }

  .tags-label {
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-secondary);
  }

  .tag-pill {
    background-color: var(--color-bg-tag);
    color: var(--color-text-primary);
    padding: var(--spacing-1) var(--spacing-3);
    border-radius: var(--radius-full);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    text-decoration: none;
    transition: background-color var(--duration-fast) var(--ease-in-out);
  }

  .tag-pill:hover {
    background-color: #c7f0ed;
  }
</style>
